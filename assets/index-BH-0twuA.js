(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const F=e=>{e.textContent=parseInt(e.textContent)+1},N=e=>{e.textContent=parseInt(e.textContent)-1},L=(e,t)=>e.classList.toggle("card__like-button_is-active",t),W=e=>{e.remove()},Z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),H=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onGetInfo:r,ownerId:s})=>{const c=Z(),l=c.querySelector(".card__like-button"),p=c.querySelector(".card__control-button_type_delete"),X=c.querySelector(".card__control-button_type_info"),g=c.querySelector(".card__image"),A=c.querySelector(".card__like-count");return c.id=e._id,g.src=e.link,g.alt=e.name,c.querySelector(".card__title").textContent=e.name,A.textContent=e.likes.length,o&&l.addEventListener("click",()=>o({likeButton:l,cardLikesElement:A})),n&&p.addEventListener("click",()=>n(c)),r&&X.addEventListener("click",()=>r(c.id)),t&&g.addEventListener("click",()=>t({name:e.name,link:e.link})),e.likes.some(Y=>Y._id===s)&&L(l,!0),e.owner._id!==s&&p.remove(),c},R=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",R)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",R)},ee=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},te=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},j=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},oe=(e,t,o)=>{if(t.validity.valid)return j(e,t,o);let n="";t.validity.patternMismatch?n=t.getAttribute("data-error-message")||t.validationMessage:n=t.validationMessage,te(e,t,n,o)},ne=e=>e.some(t=>!t.validity.valid),J=(e,t)=>{e.classList.add(t),e.disabled=!0},re=(e,t)=>{e.classList.remove(t),e.disabled=!1},D=(e,t,o)=>{ne(e)?J(t,o.inactiveButtonClass):re(t,o.inactiveButtonClass)},se=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);D(o,n,t),o.forEach(r=>{r.addEventListener("input",s=>{oe(e,r,t),D(o,n,t)})})},q=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(r=>{j(e,r,t)});const n=e.querySelector(t.submitButtonSelector);J(n,t.inactiveButtonClass)},ce=e=>{document.querySelectorAll(e.formSelector).forEach(o=>{se(o,e)})},ae="bb8dccbd-3e73-4afb-82c2-a9def3d7514a",ie="apf-cohort-202",le="https://mesto.nomoreparties.co/v1",a={baseUrl:`${le}/${ie}`,headers:{authorization:ae,"Content-Type":"application/json"}},E=e=>new Promise(t=>setTimeout(t,e)),i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ue=async()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(i),V=async()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(i),de=async({avatar:e})=>(await E(1e3),fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(i)),pe=async({name:e,about:t})=>(await E(1e3),fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(i)),me=async({name:e,link:t})=>(await E(1e3),fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(i)),K=async e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(i),z=async(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"PUT":"DELETE",headers:a.headers}).then(i),d=(e,t,o={})=>{const{loadingText:n="Загрузка...",loadingClass:r="button_loading"}=o;t?(e._originalText=e.textContent,e.disabled=!0,e.textContent=n,r&&e.classList.add(r)):(e.disabled=!1,e.textContent=e._originalText||e.textContent,r&&e.classList.remove(r))},I=e=>e.querySelector('button[type="submit"]'),G=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__form"),C=S.querySelector(".popup__input_type_name"),b=S.querySelector(".popup__input_type_description"),w=document.querySelector(".popup_type_info"),m=w.querySelector(".popup__info"),$=w.querySelector(".popup__list"),_e=document.querySelector("#popup-info-definition-template"),fe=document.querySelector("#popup-info-user-preview-template"),x=document.querySelector(".popup_type_new-card"),_=x.querySelector(".popup__form"),ye=_.querySelector(".popup__input_type_card-name"),ve=_.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),O=B.querySelector(".popup__image"),Se=B.querySelector(".popup__caption"),he=document.querySelector(".profile__edit-button"),ge=document.querySelector(".profile__add-button"),T=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),v=M.querySelector(".popup__form"),Ce=v.querySelector(".popup__input"),h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ce(h);const Q=({name:e,link:t})=>{O.src=t,O.alt=e,Se.textContent=e,f(B)},be=async e=>{e.preventDefault();const t=e.target,o=I(t),n={loadingText:"Сохранение...",loadingClass:"popup__button_loading"};d(o,!0,n);const r={name:C.value,about:b.value};await pe(r),d(o,!1,n),T.textContent=C.value,P.textContent=b.value,u(k)},Le=async e=>{e.preventDefault();const t=e.target,o=I(t),n={loadingText:"Сохранение...",loadingClass:"popup__button_loading"};d(o,!0,n);const r={avatar:Ce.value},s=await de(r);d(o,!1,n),U.style.backgroundImage=`url(${s.avatar})`,u(M)},qe=async e=>{e.preventDefault();const t=e.target,o=I(t),n={loadingText:"Создание...",loadingClass:"popup__button_loading"};d(o,!0,n);const r={name:ye.value,link:ve.value},s=await me(r);d(o,!1,n),G.prepend(H(s,{onPreviewPicture:Q,onDeleteCard:c=>{K(c.id),W(c)},onLikeIcon:({likeButton:c,cardLikesElement:l})=>{const p=L(c);z(s._id,p),p?F(l):N(l)},ownerId:s.owner._id})),u(x)},Ee=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),y=(e,t)=>{const o=_e.content.querySelector(".popup__info-item").cloneNode(!0),n=o.querySelector(".popup__info-term"),r=o.querySelector(".popup__info-description");return n.textContent=e,r.textContent=t,o.append(n,r),o},Ie=e=>{const t=fe.content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},ke=e=>{m.innerHTML="",$.innerHTML="",V().then(t=>{const o=t.find(n=>n._id===e);if(!o)throw new Error("Card not found");m.append(y("Описание:",o.name)),m.append(y("Дата создания:",Ee(new Date(o.createdAt)))),m.append(y("Владелец:",o.owner.name)),m.append(y("Количество лайков:",o.likes.length)),o.likes.forEach(n=>{$.append(Ie(n.name))}),f(w)}).catch(t=>{console.error(t)})};S.addEventListener("submit",be);_.addEventListener("submit",qe);v.addEventListener("submit",Le);he.addEventListener("click",()=>{C.value=T.textContent,b.value=P.textContent,q(S,h),f(k)});U.addEventListener("click",()=>{v.reset(),q(v,h),f(M)});ge.addEventListener("click",()=>{_.reset(),q(_,h),f(x)});const we=document.querySelectorAll(".popup");we.forEach(e=>{ee(e)});Promise.all([V(),ue()]).then(([e,t])=>{e.forEach(o=>{G.append(H(o,{onPreviewPicture:Q,onDeleteCard:n=>{K(n.id),W(n)},onLikeIcon:({likeButton:n,cardLikesElement:r})=>{const s=L(n);z(o._id,s),s?F(r):N(r)},onGetInfo:ke,ownerId:t._id}))}),T.textContent=t.name,P.textContent=t.about,U.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.error(e)});
